"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var Scope = function Scope() {
  var _this2 = this;

  _classCallCheck(this, Scope);

  _defineProperty(this, "resetPassword", function () {
    localStorage.setItem('auth', false);
    this.container.forceLogout();
  });

  _defineProperty(this, "fetchPassword", function () {
    var _this = this;

    var userPassword;
    this.loading = true;
    chrome.storage.sync.get(['userPassword'], function (result) {
      userPassword = result.userPassword;

      if (typeof userPassword !== 'undefined') {
        _this.define(userPassword);
      }
    });
  });

  _defineProperty(this, "define", function (pass) {
    this.loading = false;
    this.manager.userPassword = pass;
    this.manager.status = 'CONNECTED';
  });

  _defineProperty(this, "hash", function (string) {
    var hash = 0,
        i,
        chr;
    if (string.length === 0) return hash;

    for (i = 0; i < string.length; i++) {
      chr = string.charCodeAt(i);
      hash = (hash << 5) - hash + chr;
      hash |= 0;
    }

    return hash.toString();
  });

  _defineProperty(this, "defineTimer", function (_int) {
    this.container.blocker.time = _int;
    this.container.auth.release();
  });

  // **
  // * Container
  // * Responsável por todo o controle de acesso
  this.container = new Container(); // **
  // * Theme
  // * Responsável por opções do usuário

  this.theme = new Theme({
    methods: {
      logout: function logout() {
        return _this2.resetPassword();
      },
      timer: function timer(_int2) {
        return _this2.defineTimer(_int2);
      },
      refresh: function refresh() {
        return _this2.container.refreshHandler.blocker();
      }
    }
  });
  this.loading = false;
  this.manager = {
    userPassword: this.fetchPassword(),
    domPassword: '',
    status: 'NO_CONNECTION'
  }; // **
  // * Adicionar Event Handler do acesso

  this.handler = function () {
    var _this3 = this;

    $('#blockedContent').addClass('hasEvent');
    $('#blockedContent').find('[login]').on('click', function (e) {
      e.preventDefault();
      _this3.domPassword = _this3.hash(_this3.container.blocker.passwordTyped);

      if (_this3.domPassword === _this3.manager.userPassword) {
        _this3.container.breakStep();

        _this3.container.timeout();
      } else {
        _this3.container.badLogin();
      }
    });
  }; // **
  // * Interval
  // * Por uma falha de planejamento eu preciso adicionar o evento por loop


  setInterval(function () {
    if (!!$('#blockedContent').length && !$('#blockedContent').hasClass('hasEvent')) {
      _this2.handler();
    }

    if (localStorage.getItem('auth') === 'true') {
      $('html').addClass('online');
    } else {
      $('html').removeClass('online');
    }
  }, 100);
};
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var Container = function Container() {
  var _this = this;

  _classCallCheck(this, Container);

  _defineProperty(this, "base", function () {
    var $app, app;
    $app = $('#controllerApp');

    if (!!$app.length) {
      return $app;
    } else {
      app = document.createElement('div');
      app.id = 'controllerApp';
      $('body').append(app);
      $app = $('#controllerApp');
      return $app;
    }
  });

  _defineProperty(this, "shove", function (to, newDom) {
    $(to).html(newDom);
  });

  _defineProperty(this, "timeout", function () {
    if (!this.auth.running) {
      this.auth.running = true;
      this.auth.countDown();
    }
  });

  _defineProperty(this, "block", function () {
    var bool;
    bool = localStorage.getItem('auth');
    if (bool === null) this.forceLogout();
    bool = bool.includes('true') ? true : false;
    this.auth.interval = false;

    if (bool) {
      this.shove(this.base(), this.blocker.html());
      this.blocker.setEvents();
    } else {
      this.shove(this.base(), this.definePassword.html());
      this.definePassword.setEvents();
    }
  });

  _defineProperty(this, "forceLogout", function () {
    localStorage['remember-me'] = false;
    localStorage.setItem('auth', 'false');
    window.location.href = window.location.href;
  });

  _defineProperty(this, "refresh", function () {
    if (this.step === 'blocker') {
      $('#blockedContent').remove();
      this.block();
    }
  });

  _defineProperty(this, "badLogin", function () {
    var $container, chances;

    if (!localStorage.getItem('loginChance')) {
      localStorage.setItem('loginChance', 3);
    }

    chances = function chances(command) {
      var value;

      if (command === 'sub') {
        value = localStorage.getItem('loginChance');
        value = parseFloat(value);
        value--;
      } else {
        value = parseFloat(localStorage.getItem('loginChance'));
      }

      return value;
    };

    localStorage.setItem('loginChance', chances('sub'));

    if (this.blocker.chance === 0) {
      this.forceLogout();
      return;
    }

    this.refresh();
  });

  _defineProperty(this, "setPassword", function (password) {
    chrome.storage.sync.set({
      userPassword: _this.hash(password)
    });
    localStorage.setItem('auth', true);
    localStorage.setItem('loginChance', 3);
  });

  _defineProperty(this, "breakStep", function () {
    var $container;
    this.auth.interval = true;
    $container = $('#controllerApp').remove();
    this.timeout();
    localStorage.setItem('loginChance', 3);
  });

  _defineProperty(this, "getInputPassword", function () {
    var $container, $input;
    $container = $('#blockedContent');

    if (!$container.length) {
      return 'Algo deu errado.';
    }

    $input = $container.find('input');
    return $input.val();
  });

  _defineProperty(this, "hash", function (string) {
    var hash = 0,
        i,
        chr;
    if (string.length === 0) return hash;

    for (i = 0; i < string.length; i++) {
      chr = string.charCodeAt(i);
      hash = (hash << 5) - hash + chr;
      hash |= 0;
    }

    return hash.toString();
  });

  this.step = 'NULL';
  this.blocker = {
    chance: function chance() {
      return parseFloat(localStorage.getItem('loginChance'));
    },
    time: 120,
    html: function html() {
      this.defineStep();
      return "\n                    <div class=\"container\" id=\"blockedContent\">\n                        <h3>Blocked Content</h3>\n                        <input type=\"password\" result placeholder=\"Password\" />\n                        <label id=\"status\">You have ".concat(this.chance(), " chances until self-destruct</label>\n                        <div class=\"controller\">\n                            <a class=\"btn btn-primary\" login>Login</a>\n                            <a class=\"btn btn-secondary\" logout>Logout</a>\n                        </div>\n                    </div>\n                    ");
    },
    passwordTyped: '',
    setEvents: function setEvents() {
      $('#blockedContent [logout]').on('click', function (e) {
        _this.forceLogout();
      });
      $('#blockedContent [result]').on('keyup', function (e) {
        _this.blocker.passwordTyped = e.currentTarget.value;
      });
    },
    defineStep: function defineStep() {
      _this.step = 'blocker';
    }
  };
  this.auth = {
    running: false,
    interval: false,
    shoudClear: false,
    countDown: function countDown() {
      var counter = 0,
          ID;
      _this.shoudClear = false;
      ID = setInterval(function () {
        if (!!_this.auth.interval) {
          counter++;
        }

        if (counter === 10 && _this.auth.interval) {
          counter = 0;

          _this.block();
        }

        if (!!_this.shoudClear) {
          clearInterval(ID);
        }
      }, _this.blocker.time * 100);
    },
    release: function release() {
      _this.auth.shoudClear = true;
      setTimeout(function () {
        _this.auth.countDown();
      }, _this.blocker.time * 100 + 1000);
    }
  };
  this.definePassword = {
    auth: localStorage.getItem('auth'),
    html: function html() {
      this.step = 'definePassword';
      return "\n                    <div class=\"container\" id=\"register\">\n                        <h3>Registre sua senha</h3>\n                        <div class=\"wrap\">\n                            <input type=\"password\" placeholder=\"nova senha\" />\n                            <input type=\"password\" placeholder=\"digite novamente\" />\n                        </div>\n                        <a href=\"#\" class=\"btn btn-primary\" id=\"submit\">Registrar</a>\n                        <label for=\"error\"></label>\n                    </div>\n                    ";
    },
    setEvents: function setEvents() {
      $('#register').find('.toggle-view').on('click', function (e) {
        var $self, type;
        e.preventDefault();
        $self = $(e.currentTarget);
        $self = $self.parent().find('input');
        type = $self.attr('type');
        type = type === 'password' ? 'text' : 'password';
        $self.attr('type', type);
      });
      $('#register').find('#submit').on('click', function (e) {
        var $inputs;
        e.preventDefault();
        $('#register').find('label').text('');
        $inputs = $('#register').find('input');

        if ($inputs.eq(0).val() === $inputs.eq(1).val() && $inputs.eq(0).val().length >= 4 && $inputs.eq(1).val() >= 4) {
          _this.setPassword($inputs.eq(0).val());

          _this.breakStep();
        } else {
          $('#register').find('label').text('A senha não bate ou é muito curta');
        }
      });
    }
  };
  this.refreshHandler = {
    blocker: function blocker() {
      $('#blockedContent').remove();

      _this.block();
    },
    definePassword: function definePassword() {
      $('#register').remove();

      _this.block();
    }
  };
  this.block();
};
"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var Theme = function Theme(props) {
  var _this2 = this;

  _classCallCheck(this, Theme);

  _defineProperty(this, "shove", function (item) {
    $('._3lq69 > span').append(item.html());
    item.setEvents();
  });

  _defineProperty(this, "pageLoaded", function (callback) {
    var _this = this;

    var ID = setInterval(function () {
      if (!!$('._3lq69 > span').length) {
        clearInterval(ID);

        _this.done(callback);
      }
    });
  });

  _defineProperty(this, "done", function (callback) {
    callback.call();
  });

  _defineProperty(this, "setTheme", function (string, sudo) {
    var themeColor;
    string = string !== undefined && string.length >= 3 ? string : 'default';
    sudo = sudo !== undefined ? sudo : false;
    themeColor = localStorage.getItem('theme');

    if (themeColor !== undefined && themeColor.length >= 3 && !sudo) {
      $('html').attr('theme', themeColor);
    } else {
      $('html').attr('theme', string);
    }
  });

  this.props = props;
  this.methods = {
    logout: function logout() {
      return _this2.props.methods.logout();
    },
    timer: function timer(_int) {
      return _this2.props.methods.timer(_int);
    },
    refresh: function refresh() {
      return _this2.props.methods.refresh();
    }
  };
  this.builder = new Builder();
  this.options = {
    html: function html() {
      return "\n                    <div class=\"_3j8Pd\">\n                        <div role=\"button\" optionCaller title=\"Options\">\n                            <span data-icon=\"status-v3-unread\" class=\"\">\n                            <svg\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                viewBox=\"0 0 256.02 362.67\"\n                                style=\"\n                                width: auto;\n                                height: 24px;\n                                \"\n                            >\n                                <title>mask</title>\n                                <defs xmlns=\"http://www.w3.org/2000/svg\">\n                                <style>\n                                    .cls-1 {\n                                    fill: #009588;\n                                    }\n                                    .cls-2 {\n                                    fill: #80868a;\n                                    }\n                                </style>\n                                </defs>\n                                <g\n                                xmlns=\"http://www.w3.org/2000/svg\"\n                                id=\"Camada_2\"\n                                data-name=\"Camada 2\"\n                                >\n                                <g id=\"Capa_1\" data-name=\"Capa 1\">\n                                    <path\n                                    class=\"cls-1\"\n                                    d=\"M96,170.67H74.68a10.67,10.67,0,0,0,0,21.33H96a10.67,10.67,0,0,0,0-21.33Z\"\n                                    />\n                                    <path\n                                    class=\"cls-1\"\n                                    d=\"M181.34,170.67H160A10.67,10.67,0,0,0,160,192h21.33a10.67,10.67,0,0,0,0-21.33Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M241.65,211.56a10.64,10.64,0,0,0-12.93,7.79C213.79,279.55,173.32,320,128,320S42.23,279.55,27.29,219.35a10.67,10.67,0,1,0-20.71,5.14C23.92,294.38,72.71,341.33,128,341.33s104.08-47,121.43-116.84A10.68,10.68,0,0,0,241.65,211.56Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M128,0C57.5,0,2.27,56.24,2.27,128a10.67,10.67,0,0,0,21.33,0C23.6,68.18,69.45,21.33,128,21.33S232.41,68.18,232.41,128a10.67,10.67,0,0,0,21.33,0C253.75,56.23,198.52,0,128,0Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M208.58,225.77a10.65,10.65,0,0,0-14.78,3l-15,22.51a10.64,10.64,0,0,1-8.87,4.76H166c-4.91,0-9.15-3.33-10.86-9.6l-6.64-15.85a10.65,10.65,0,0,0-9.83-6.55H117.34a10.69,10.69,0,0,0-9.86,6.57l-7.12,17.37A10.66,10.66,0,0,1,90,256H86.09a10.64,10.64,0,0,1-8.87-4.76l-15-22.51a10.66,10.66,0,1,0-17.75,11.82l15,22.51a32,32,0,0,0,26.62,14.25H90c14.72,0,27.48-10,30.55-22.7l3.88-9.3h7.19L135,253.1a32,32,0,0,0,31,24.23h3.92a31.94,31.94,0,0,0,26.62-14.27l15-22.51A10.65,10.65,0,0,0,208.58,225.77Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M94.79,219a10.68,10.68,0,0,0-14.4-4.5c-7.57,4-32.3,9.45-59.05,9.45a10.67,10.67,0,1,0,0,21.33c30,0,57.94-6.12,68.95-11.88A10.66,10.66,0,0,0,94.79,219Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M234.68,224c-26.75,0-51.48-5.48-59.05-9.45a10.67,10.67,0,0,0-9.9,18.9c11,5.76,38.91,11.88,68.95,11.88a10.67,10.67,0,1,0,0-21.33Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M113.65,141.25c-8.9-7.68-54.49-44.82-78.51-20.8a10.67,10.67,0,0,0,15.08,15.08c6.93-6.89,33.49,8.09,49.49,21.87a10.66,10.66,0,0,0,13.93-16.15Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M220.87,120.47c-24-24-69.61,13.12-78.51,20.8a10.66,10.66,0,0,0,13.93,16.15c16-13.8,42.62-28.74,49.49-21.87a10.67,10.67,0,0,0,15.08-15.08Z\"\n                                    />\n                                    <path\n                                    class=\"cls-2\"\n                                    d=\"M249.89,65c-45.59-21.4-118.68-22.31-122-22.34-3.09,0-76.18.94-121.77,22.34A10.7,10.7,0,0,0,0,75.11L6.28,222.36c.26,5.91,5.4,10.75,11.12,10.22a10.66,10.66,0,0,0,10.2-11.12l-6-139.93C63.48,64.81,127.43,64,127.9,64c.68,0,64.62.81,106.48,17.54l-6,139.93a10.66,10.66,0,0,0,10.2,11.12h.47a10.7,10.7,0,0,0,10.67-10.22L256,75.11A10.72,10.72,0,0,0,249.89,65Z\"\n                                    />\n                                    <path\n                                    class=\"cls-1\"\n                                    d=\"M140.42,277.46a10.63,10.63,0,0,0-12.27,8.77l-.15.88-.15-.85a10.66,10.66,0,1,0-21,3.5l10.67,64a10.66,10.66,0,0,0,21,0l10.67-64A10.66,10.66,0,0,0,140.42,277.46Z\"\n                                    />\n                                </g>\n                                </g>\n                            </svg>\n                            </span>\n                        </div>\n                        <span class=\"plugin-options\">\n                            <div\n                            tabindex=\"-1\"\n                            class=\"_2hHc6 T6CTG\"\n                            style=\"transform-origin: right top; transform: scale(1); opacity: 1;\"\n                            >\n                            <ul class=\"_3z3lc\">\n                                <li\n                                tabindex=\"-1\"\n                                class=\"_3cfBY _2yhpw _3BqnP\"\n                                data-animate-dropdown-item=\"true\"\n                                style=\"opacity: 1;\"\n                                >\n                                <div\n                                    class=\"_3zy-4 Sl-9e\"\n                                    role=\"button\"\n                                    command=\"new_password\"\n                                    title=\"Define new Password\"\n                                >\n                                    Define new Password\n                                </div>\n                                </li>\n                                <li\n                                tabindex=\"-1\"\n                                class=\"_3cfBY _2yhpw _3BqnP\"\n                                data-animate-dropdown-item=\"true\"\n                                style=\"opacity: 1;\"\n                                >\n                                <div\n                                    class=\"_3zy-4 Sl-9e\"\n                                    role=\"button\"\n                                    command=\"new_theme\"\n                                    title=\"Change your theme\"\n                                >\n                                    Switch Theme\n                                </div>\n                                </li>\n                                <li\n                                tabindex=\"-1\"\n                                class=\"_3cfBY _2yhpw _3BqnP\"\n                                data-animate-dropdown-item=\"true\"\n                                style=\"opacity: 1;\"\n                                >\n                                <div\n                                    class=\"_3zy-4 Sl-9e\"\n                                    role=\"button\"\n                                    command=\"do_lock\"\n                                    title=\"Instant lock\"\n                                >\n                                    Instant Lock\n                                </div>\n                                </li>\n                                <li\n                                tabindex=\"-1\"\n                                class=\"_3cfBY _2yhpw _3BqnP\"\n                                data-animate-dropdown-item=\"true\"\n                                style=\"opacity: 1;\"\n                                >\n                                <div\n                                    class=\"_3zy-4 Sl-9e\"\n                                    role=\"button\"\n                                    command=\"new_timer\"\n                                    title=\"Change timer for password lock\"\n                                >\n                                    Set timer\n                                </div>\n                                </li>\n                            </ul>\n                            </div>\n                        </span>\n                    </div>\n                    ";
    },
    setEvents: function setEvents() {
      var $btnOptions, $optionList, $selected;
      $btnOptions = $('[optionCaller]');
      $optionList = $('.plugin-options');
      $btnOptions.on('click', function (e) {
        $optionList.toggleClass('display');
      });
      $optionList.find('._3cfBY').on('click', function (e) {
        $selected = $(e.currentTarget).find('[command]');

        switch ($selected.attr('command')) {
          case 'new_timer':
            var localState = {
              inputValue: '',
              self: $selected
            };
            localState.self.addClass('disabled');

            _this2.builder.newTimer().appender().on('keyup', function (event) {
              localState.inputValue = event.currentTarget.value;

              if (event.keyCode === 13) {
                var intValue;
                intValue = parseFloat(localState.inputValue);
                intValue = typeof intValue === 'number' && intValue >= 3 ? intValue : 120;

                _this2.methods.timer(intValue);

                $(event.currentTarget).parent().remove();
                localState.self.removeClass('disabled');
                $optionList.toggleClass('display');
              }
            });

            break;

          case 'new_password':
            _this2.methods.logout();

            $optionList.toggleClass('display');
            break;

          case 'do_lock':
            _this2.methods.refresh();

            $optionList.toggleClass('display');
            break;

          case 'new_theme':
            _this2.builder.themes();

            $optionList.toggleClass('display');
            break;

          default:
            console.log('click could not find command');
        }
      });
    }
  };
  this.pageLoaded(function () {
    return _this2.shove(_this2.options);
  });
  this.setTheme();
}; // **
// * Responsável por criar containers


var Builder = function Builder() {
  _classCallCheck(this, Builder);

  _defineProperty(this, "appendTo", function (target, elem) {
    $(target).append(elem);
  });

  _defineProperty(this, "newTimer", function () {
    var caller = {
      html: "\n                    <div class=\"newTimer\">\n                        <input type=\"number\" id=\"inputTimer\" placeholder=\"new timer value\" title=\"Add new timer value then press enter\">\n                    </div>\n                ",
      appender: function appender() {
        if (!!$('.newTimer').length) return $('.newTimer input');
        $('._2hHc6').append(this.html);
        return $('.newTimer input');
      }
    };
    return caller;
  });

  _defineProperty(this, "themes", function () {
    var caller = {
      html: "\n            <div class=\"container\" id=\"modal-theme\">\n                <div class=\"board\">\n                    <div class=\"board-header\">\n                        <ul>\n                            <li><span></span></li>\n                            <li><span></span></li>\n                            <li><span></span></li>\n                        </ul>\n                    </div>\n                    <div class=\"board-body\">\n                        <h2>Choose a theme</h2>\n                        <ul>\n                            <li theme=\"light\">\n                                <h3>Light</h3>\n                            </li>\n                            <li theme=\"dark\">\n                                <h3>Dark</h3>\n                            </li>\n                            <li theme=\"default\">\n                                <h3>Default</h3>\n                            </li>\n                            <li theme=\"pink\">\n                                <h3>Pink</h3>\n                            </li>\n                        </ul>\n                    </div>\n                    <div class=\"board-footer\">\n                        <a href=\"#\" class=\"btn btn-primary\">Choose</a>\n                    </div>\n                </div>\n            </div>\n            ",
      appender: function appender() {
        var _this3 = this;

        $('body').append(this.html);
        setTimeout(function () {
          _this3.setEvents();
        }, 1000);
      },
      setEvents: function setEvents() {
        $('#modal-theme').find('li').on('click', function (e) {
          var $self, scheme;
          $self = $(e.currentTarget);
          scheme = $self.attr('theme');
          $('#modal-theme').find('.active').removeClass('active');
          $self.addClass('active');
          $('html').attr('theme', scheme);
          localStorage.setItem('theme', scheme);
        });
        $('#modal-theme').find('.btn').on('click', function (e) {
          $('#modal-theme').remove();
        });
      }
    };
    caller.appender();
  });
};
"use strict";

$(document).ready(function () {
  var scope = new Scope();
});